 stage('test-examples') {

    if (env.SGX == "1") {
        env.MODE = "sgx"
    }
    else {
        env.MODE = "direct"
    }

    if (["ubuntu", "rhel", "centos"].contains(env.os_release_id)) {
     if (env.no_cpu.toInteger() > 16) {
        try {
               timeout(time:30,unit: 'MINUTES') {
                sh '''
                  cd CI-Examples/mysql
                  make privileges
                  if [ "${os_release_id}" != 'ubuntu' ]
                  then
                        make privileges-rhel
                  fi
                  make ${MAKEOPTS} all && make ${MAKEOPTS} check
                  sleep 150s
                  make conncheck
                  make clean
                 '''
                }
           } catch (Exception e) {}
       }
   }

    if (env.no_cpu.toInteger() > 16)  {
        try {
            timeout(time: 20, unit: 'MINUTES') {
                sh '''
                    cd CI-Examples/mariadb
                    sudo -E make install-mariadb
                    make clean && make ${MAKEOPTS} 
                    make ${MAKEOPTS} test-gramine 2>&1 | tee RESULT
                '''
                }
            }  catch (Exception e) { }         
        }
}
